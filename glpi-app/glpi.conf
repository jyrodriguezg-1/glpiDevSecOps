# glpi-app/glpi.conf

server {
    listen 80 default_server;
    server_name _;

    root   /var/www/html/glpi;
    index  index.php index.html;

    client_max_body_size 100M;

    # 1) Assets del instalador
    location ~* ^/install/(?:css|js|pics)/ {
        expires    1d;
        access_log off;
    }

    # 2) Archivos estáticos (js, css, imágenes…)
    location ~* \.(?:ico|css|js|gif|jpe?g|png|webp|svg|woff2?)$ {
        expires    30d;
        access_log off;
    }

    # 3) Resto de la app → index.php (incluye GET a /install/install.php si no existe)
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # 4) TODOS los .php (incluye POST a /install/install.php)
    location ~ \.php$ {
        include        fastcgi.conf;                # IMPORTANTE: trae SCRIPT_FILENAME y HTTP_COOKIE
        fastcgi_pass   127.0.0.1:9000;              # coincide con tu pool de PHP-FPM
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    # 5) Denegar ficheros ocultos
    location ~ /\.(?!well-known).* {
        deny all;
    }
}
