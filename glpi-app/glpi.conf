server {
    listen 80 default_server;
    server_name _;

    root /var/www/html/glpi;
    index index.php index.html;

    client_max_body_size 100M;

    # 1) Instalador de GLPI
    location ^~ /install {
        # Pasamos cualquier /install/* a install.php
        try_files $uri $uri/ /install/install.php?$args;
    }

    # 2) Archivos estáticos de instalación
    location ~* ^/install/(?:css|js|pics)/ {
        expires 1d;
        access_log off;
    }

    # 3) Archivos estáticos generales (css, js, imágenes)
    location ~* \.(?:ico|css|js|gif|jpe?g|png|webp|svg|woff2?)$ {
        expires 30d;
        access_log off;
    }

    # 4) Bloque general para la aplicación
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # 5) Procesamiento PHP vía PHP-FPM
    location ~ \.php$ {
        include fastcgi.conf;                    # recogen HTTP_COOKIE, SCRIPT_FILENAME, etc.
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
    }

    # 6) Denegar accesos a .files sensibles
    location ~ /\.(?!well-known).* {
        deny all;
    }

    # (Opcional) Si quieres proteger /files upload hasta después de la instalación:
    #location ^~ /files/ {
    #    internal;
    #    alias /var/www/html/glpi/files/;
    #}
}
